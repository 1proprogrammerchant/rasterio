

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Resampling &mdash; rasterio 1.0a10 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="rasterio 1.0a10 documentation" href="../index.html"/>
        <link rel="next" title="Tagging datasets and bands" href="tags.html"/>
        <link rel="prev" title="Reprojection" href="reproject.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> rasterio
          

          
          </a>

          
            
            
              <div class="version">
                1.0a10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../switch.html">Switching from GDAL’s Python bindings</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="color.html">Color</a></li>
<li class="toctree-l1"><a class="reference internal" href="concurrency.html">Concurrent processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Vector Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="fillnodata.html">Filling nodata areas</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing.html">Georeferencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_options.html">Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_processing.html">Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="masking-by-shapefile.html">Masking a raster using a shapefile</a></li>
<li class="toctree-l1"><a class="reference internal" href="masks.html">Nodata Masks</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory-files.html">In-Memory Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrating-to-v1.html">Migrating to Rasterio 1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="overviews.html">Overviews</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="reproject.html">Reprojection</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Resampling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#up-and-downsampling">Up and Downsampling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#use-reproject">Use reproject</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-scipy">Use scipy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-decimated-reads">Use decimated reads</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#resampling-methods">Resampling Methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tags.html">Tagging datasets and bands</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtual-warping.html">Virtual Warping</a></li>
<li class="toctree-l1"><a class="reference internal" href="vsi.html">Virtual Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="windowed-rw.html">Windowed reading and writing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">rasterio package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Users Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rasterio</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Resampling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/topics/resampling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="resampling">
<h1>Resampling<a class="headerlink" href="#resampling" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>For details on changing coordinate reference systems, see <cite>Reprojection</cite>.</div></blockquote>
<div class="section" id="up-and-downsampling">
<h2>Up and Downsampling<a class="headerlink" href="#up-and-downsampling" title="Permalink to this headline">¶</a></h2>
<p><em>Resampling</em> refers to changing the cell values due to changes in the raster cell grid. This can occur during reprojection. Even if the crs is not changing, we may want to change the effective cell size of an existing dataset.</p>
<p><em>Upsampling</em> refers to cases where we are converting to higher resolution/smaller cells.
<em>Downsampling</em> is resampling to lower resolution/larger cellsizes.</p>
<p>There are three potential ways to perform up/downsampling.</p>
<div class="section" id="use-reproject">
<h3>Use reproject<a class="headerlink" href="#use-reproject" title="Permalink to this headline">¶</a></h3>
<p>If you use <code class="docutils literal"><span class="pre">reproject</span></code> but keep the same CRS, you can utilize the underlying GDAL algorithms
to resample your data.</p>
<p>This involves coordinating the size of your output array with the
cell size in it’s associated affine transform. In other words, if you <em>multiply</em> the resolution
by <code class="docutils literal"><span class="pre">x</span></code>, you need to <em>divide</em> the affine parameters defining the cell size by <code class="docutils literal"><span class="pre">x</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">newarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># same number of bands</span>
                         <span class="nb">round</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">),</span> <span class="c1"># 150% resolution</span>
                         <span class="nb">round</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)))</span>

<span class="c1"># adjust the new affine transform to the 150% smaller cell size</span>
<span class="n">aff</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span>
<span class="n">newaff</span> <span class="o">=</span> <span class="n">Affine</span><span class="p">(</span><span class="n">aff</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">aff</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">aff</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                <span class="n">aff</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">aff</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">aff</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>

<span class="n">reproject</span><span class="p">(</span>
    <span class="n">arr</span><span class="p">,</span> <span class="n">newarr</span><span class="p">,</span>
    <span class="n">src_transform</span> <span class="o">=</span> <span class="n">aff</span><span class="p">,</span>
    <span class="n">dst_transform</span> <span class="o">=</span> <span class="n">newaff</span><span class="p">,</span>
    <span class="n">src_crs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
    <span class="n">dst_crs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
    <span class="n">resampling</span> <span class="o">=</span> <span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="use-scipy">
<h3>Use scipy<a class="headerlink" href="#use-scipy" title="Permalink to this headline">¶</a></h3>
<p>You can also use <a class="reference external" href="http://docs.scipy.org/doc/scipy-0.16.1/reference/generated/scipy.ndimage.interpolation.zoom.html">scipy.ndimage.interpolation.zoom</a> to “zoom” with a configurable spline interpolation
that differs from the resampling methods available in GDAL. This may not be appropriate for all data so check the results carefully. You must adjust the affine transform just as we did above.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.ndimage.interpolation</span> <span class="kn">import</span> <span class="n">zoom</span>

<span class="c1"># Increase resolution, decrease cell size by 150%</span>
<span class="c1"># Note we only zoom on axis 1 and 2</span>
<span class="c1"># axis 0 (our band axis) stays fixed</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">newarr</span> <span class="o">=</span> <span class="n">zoom</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># Adjust original affine transform</span>
<span class="n">aff</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span>
<span class="n">newaff</span> <span class="o">=</span> <span class="n">Affine</span><span class="p">(</span><span class="n">aff</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">aff</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">aff</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                <span class="n">aff</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">aff</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">aff</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="use-decimated-reads">
<h3>Use decimated reads<a class="headerlink" href="#use-decimated-reads" title="Permalink to this headline">¶</a></h3>
<p>Another technique for quickly up/downsampling data is to use decimated reads.
By reading from a raster source into an <code class="docutils literal"><span class="pre">out</span></code> array of a specified size, you
are effectively resampling the data to a new size.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The underlying GDALRasterIO function does not support different resampling
methods. You are stuck with the default which can result in unwanted effects
and data loss in some cases. We recommend using a different method unless
you are upsampling by an integer factor.</p>
</div>
<p>As per the previous two examples, you must also adjust the affine accordingly.</p>
<p>Note that this method is only recommended for <em>increasing</em> resolution by an integer factor.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">newarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># same number of bands</span>
                         <span class="nb">round</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="c1"># double resolution</span>
                         <span class="nb">round</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)))</span>

<span class="n">arr</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="n">newarr</span><span class="p">)</span>  <span class="c1"># newarr is changed in-place</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="resampling-methods">
<h2>Resampling Methods<a class="headerlink" href="#resampling-methods" title="Permalink to this headline">¶</a></h2>
<p>When you change the raster cell grid, you must recalulate the pixel values. There is no “correct” way to do this as all methods involve some interpolation.</p>
<p>The current resampling methods can be found in the <a class="reference external" href="https://github.com/mapbox/rasterio/blob/master/rasterio/enums.py#L28">rasterio.enums</a> source.</p>
<p>Of note, the default <code class="docutils literal"><span class="pre">Resampling.nearest</span></code> method may not be suitable for continuous data. In those
cases, <code class="docutils literal"><span class="pre">Resampling.bilinear</span></code> and <code class="docutils literal"><span class="pre">Resampling.cubic</span></code> are better suited.
Some specialized statistical resampling method exist, e.g. <code class="docutils literal"><span class="pre">Resampling.average</span></code>, which may be
useful when certain numerical properties of the data are to be retained.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tags.html" class="btn btn-neutral float-right" title="Tagging datasets and bands" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="reproject.html" class="btn btn-neutral" title="Reprojection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Mapbox.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0a10',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>