

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Rasterio Cookbook &mdash; rasterio 0.35.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="rasterio 0.35.1 documentation" href="index.html"/>
        <link rel="up" title="rasterio Python User’s Manual" href="python_manual.html"/>
        <link rel="next" title="Migration Guide for osgeo.gdal users" href="osgeo_gdal_migration.html"/>
        <link rel="prev" title="Developers guide" href="developers.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> rasterio
          

          
          </a>

          
            
            
              <div class="version">
                0.35.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="python_manual.html"><code class="docutils literal"><span class="pre">rasterio</span></code> Python User&#8217;s Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_model.html">Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="reading.html">Reading Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="working_with_datasets.html">Working with Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing.html">Writing Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="topics.html">General Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html">Developers guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Rasterio Cookbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-summary-statistics-for-each-band">Generating summary statistics for each band</a></li>
<li class="toctree-l3"><a class="reference internal" href="#raster-algebra">Raster algebra</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resampling-rasters-to-a-different-cell-size">Resampling rasters to a different cell size</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reproject-warp-a-raster-to-a-different-crs">Reproject/warp a raster to a different CRS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#raster-to-polygon-features">Raster to polygon features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rasterizing-geojson-features">Rasterizing GeoJSON features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#masking-raster-with-a-polygon-feature">Masking raster with a polygon feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-valid-data-bounding-polygons">Creating valid data bounding polygons</a></li>
<li class="toctree-l3"><a class="reference internal" href="#raster-to-vector-line-feature">Raster to vector line feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-raster-from-numpy-array">Creating raster from numpy array</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-least-cost-path">Creating a least cost path</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-a-scipy-filter-to-smooth-a-raster">Using a scipy filter to smooth a raster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-skimage-to-adjust-the-saturation-of-a-rgb-raster">Using skimage to adjust the saturation of a RGB raster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-a-kmz-from-a-raster">Generating a KMZ from a raster</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="osgeo_gdal_migration.html">Migration Guide for osgeo.gdal users</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html"><code class="docutils literal"><span class="pre">rio</span></code> Command Line User&#8217;s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_docs.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Community</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">rasterio</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="python_manual.html"><code class="docutils literal"><span class="pre">rasterio</span></code> Python User&#8217;s Manual</a> &raquo;</li>
      
    <li>Rasterio Cookbook</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/cookbook.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rasterio-cookbook">
<h1>Rasterio Cookbook<a class="headerlink" href="#rasterio-cookbook" title="Permalink to this headline">¶</a></h1>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Fill out examples of using rasterio to handle tasks from typical
GIS and remote sensing workflows.</p>
</div>
<p>The Rasterio cookbook is intended to provide in-depth examples of rasterio usage
that are not covered by the basic usage in the User&#8217;s Manual. Before using code
from the cookbook, you should be familar with the basic usage of rasterio; see
&#8220;Reading Datasets&#8221;, &#8220;Working with Datasets&#8221; and &#8220;Writing Datasets&#8221; to brush up on
the fundamentals.</p>
<div class="section" id="generating-summary-statistics-for-each-band">
<h2>Generating summary statistics for each band<a class="headerlink" href="#generating-summary-statistics-for-each-band" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">array</span><span class="p">:</span>
    <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">band</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
        <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">band</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">band</span><span class="p">),</span>
        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">band</span><span class="o">.</span><span class="n">max</span><span class="p">()})</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="code highlight-default"><div class="highlight"><pre><span></span>$ python docs/recipes/band_summary_stats.py
[{&#39;max&#39;: 255, &#39;mean&#39;: 29.94772668847656, &#39;median&#39;: 13.0, &#39;min&#39;: 0},
 {&#39;max&#39;: 255, &#39;mean&#39;: 44.516147889382289, &#39;median&#39;: 30.0, &#39;min&#39;: 0},
 {&#39;max&#39;: 255, &#39;mean&#39;: 48.113056354742945, &#39;median&#39;: 30.0, &#39;min&#39;: 0}]
</pre></div>
</div>
</div>
<div class="section" id="raster-algebra">
<h2>Raster algebra<a class="headerlink" href="#raster-algebra" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="resampling-rasters-to-a-different-cell-size">
<h2>Resampling rasters to a different cell size<a class="headerlink" href="#resampling-rasters-to-a-different-cell-size" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="reproject-warp-a-raster-to-a-different-crs">
<h2>Reproject/warp a raster to a different CRS<a class="headerlink" href="#reproject-warp-a-raster-to-a-different-crs" title="Permalink to this headline">¶</a></h2>
<p>Reproject to a Transverse Mercator projection, Hawaii zone 3 (ftUS),
aka EPSG code 3759.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.warp</span> <span class="kn">import</span> <span class="n">calculate_default_transform</span><span class="p">,</span> <span class="n">reproject</span><span class="p">,</span> <span class="n">Resampling</span>
<span class="kn">from</span> <span class="nn">rasterio</span> <span class="kn">import</span> <span class="n">crs</span>

<span class="n">rgb</span> <span class="o">=</span> <span class="s1">&#39;tests/data/world.tif&#39;</span>
<span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;/tmp/reproj.tif&#39;</span>

<span class="c1"># Reproject to NAD83(HARN) / Hawaii zone 3 (ftUS) - Transverse Mercator</span>
<span class="n">dst_crs</span> <span class="o">=</span> <span class="n">crs</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;EPSG:3759&quot;</span><span class="p">)</span>


<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">drivers</span><span class="p">(</span><span class="n">CHECK_WITH_INVERT_PROJ</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>

        <span class="c1"># Calculate the ideal dimensions and transformation in the new crs</span>
        <span class="n">dst_affine</span><span class="p">,</span> <span class="n">dst_width</span><span class="p">,</span> <span class="n">dst_height</span> <span class="o">=</span> <span class="n">calculate_default_transform</span><span class="p">(</span>
            <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="o">*</span><span class="n">src</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

        <span class="c1"># update the relevant parts of the profile</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;crs&#39;</span><span class="p">:</span> <span class="n">dst_crs</span><span class="p">,</span>
            <span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">dst_affine</span><span class="p">,</span>
            <span class="s1">&#39;affine&#39;</span><span class="p">:</span> <span class="n">dst_affine</span><span class="p">,</span>
            <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">dst_width</span><span class="p">,</span>
            <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">dst_height</span>
        <span class="p">})</span>

        <span class="c1"># Reproject and write each band</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">src_array</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">dst_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">dst_height</span><span class="p">,</span> <span class="n">dst_width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>

                <span class="n">reproject</span><span class="p">(</span>
                    <span class="c1"># Source parameters</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">src_array</span><span class="p">,</span>
                    <span class="n">src_crs</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                    <span class="n">src_transform</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span>
                    <span class="c1"># Destination paramaters</span>
                    <span class="n">destination</span><span class="o">=</span><span class="n">dst_array</span><span class="p">,</span>
                    <span class="n">dst_transform</span><span class="o">=</span><span class="n">dst_affine</span><span class="p">,</span>
                    <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span>
                    <span class="c1"># Configuration</span>
                    <span class="n">resampling</span><span class="o">=</span><span class="n">Resampling</span><span class="o">.</span><span class="n">nearest</span><span class="p">,</span>
                    <span class="n">num_threads</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dst_array</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="code highlight-default"><div class="highlight"><pre><span></span>$ python docs/recipes/reproject.py
</pre></div>
</div>
<p>The original image</p>
<a class="reference internal image-reference" href="_images/world.jpg"><img alt="_images/world.jpg" src="_images/world.jpg" style="width: 512.0px; height: 256.0px;" /></a>
<p>Warped to <code class="docutils literal"><span class="pre">EPSG:3759</span></code>. Notice that the bounds are contrainted to the new projection&#8217;s
valid region (<code class="docutils literal"><span class="pre">CHECK_WITH_INVERT_PROJ=True</span></code> on line 13) and the new raster is wrapped seamlessly across the anti-meridian.</p>
<a class="reference internal image-reference" href="_images/reproject.jpg"><img alt="_images/reproject.jpg" src="_images/reproject.jpg" style="width: 397.0px; height: 412.0px;" /></a>
</div>
<div class="section" id="raster-to-polygon-features">
<h2>Raster to polygon features<a class="headerlink" href="#raster-to-polygon-features" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="rasterizing-geojson-features">
<h2>Rasterizing GeoJSON features<a class="headerlink" href="#rasterizing-geojson-features" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="masking-raster-with-a-polygon-feature">
<h2>Masking raster with a polygon feature<a class="headerlink" href="#masking-raster-with-a-polygon-feature" title="Permalink to this headline">¶</a></h2>
<p>Using <code class="docutils literal"><span class="pre">rasterio</span></code> with <code class="docutils literal"><span class="pre">fiona</span></code>, we can open a shapefile, read geometries, and
mask out regions of a raster that are outside the polygons defined in the shapefile.</p>
<p>This shapefile contains a single polygon, a box near the center of the raster,
so in this case, our list of geometries is one element long.</p>
<p>Applying the features in the shapefile as a mask on the raster sets all pixels outside
of the features to be zero. Since <code class="docutils literal"><span class="pre">crop=True</span></code> in this example, the extent of the raster
is also set to be the extent of the features in the shapefile.</p>
<p>We can then use the updated spatial transform and raster height and width
to write the masked raster to a new file.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.tools.mask</span> <span class="kn">import</span> <span class="n">mask</span>

<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;tests/data/box.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">shapefile</span><span class="p">:</span>
    <span class="n">geoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">shapefile</span><span class="p">]</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">out_image</span><span class="p">,</span> <span class="n">out_transform</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">geoms</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">out_meta</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">out_meta</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">out_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">out_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                 <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">out_transform</span><span class="p">})</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/tmp/masked.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">out_meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">dest</span><span class="p">:</span>
    <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_image</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="code highlight-default"><div class="highlight"><pre><span></span>$ python docs/recipes/mask_shp.py
</pre></div>
</div>
<p>The original image with the shapefile overlayed</p>
<a class="reference internal image-reference" href="_images/box_rgb.png"><img alt="_images/box_rgb.png" src="_images/box_rgb.png" style="width: 640.0px; height: 480.0px;" /></a>
<p>Masked and cropped to the geometry</p>
<a class="reference internal image-reference" href="_images/box_masked_rgb.png"><img alt="_images/box_masked_rgb.png" src="_images/box_masked_rgb.png" style="width: 640.0px; height: 480.0px;" /></a>
</div>
<div class="section" id="creating-valid-data-bounding-polygons">
<h2>Creating valid data bounding polygons<a class="headerlink" href="#creating-valid-data-bounding-polygons" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="raster-to-vector-line-feature">
<h2>Raster to vector line feature<a class="headerlink" href="#raster-to-vector-line-feature" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="creating-raster-from-numpy-array">
<h2>Creating raster from numpy array<a class="headerlink" href="#creating-raster-from-numpy-array" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="creating-a-least-cost-path">
<h2>Creating a least cost path<a class="headerlink" href="#creating-a-least-cost-path" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="using-a-scipy-filter-to-smooth-a-raster">
<h2>Using a scipy filter to smooth a raster<a class="headerlink" href="#using-a-scipy-filter-to-smooth-a-raster" title="Permalink to this headline">¶</a></h2>
<p>This recipe demonstrates scipy&#8217;s <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/signal.html#signal-processing-scipy-signal">signal processing filters</a> to manipulate multi-band raster imagery
and save the results to a new GeoTIFF. Here we apply a median filter to smooth
the image and remove small inclusions (at the expense of some sharpness and detail).</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">medfilt</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span>
<span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;/tmp/filtered.tif&quot;</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>

<span class="c1"># apply a 5x5 median filter to each band</span>
<span class="n">filtered</span> <span class="o">=</span> <span class="n">medfilt</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>

<span class="c1"># Write to tif, using the same profile as the source</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="code highlight-default"><div class="highlight"><pre><span></span>$ python docs/recipes/filter.py
</pre></div>
</div>
<p>The original image</p>
<a class="reference internal image-reference" href="_images/RGB.byte.jpg"><img alt="_images/RGB.byte.jpg" src="_images/RGB.byte.jpg" style="width: 395.5px; height: 359.0px;" /></a>
<p>With median filter applied</p>
<a class="reference internal image-reference" href="_images/filtered.jpg"><img alt="_images/filtered.jpg" src="_images/filtered.jpg" style="width: 395.5px; height: 359.0px;" /></a>
</div>
<div class="section" id="using-skimage-to-adjust-the-saturation-of-a-rgb-raster">
<h2>Using skimage to adjust the saturation of a RGB raster<a class="headerlink" href="#using-skimage-to-adjust-the-saturation-of-a-rgb-raster" title="Permalink to this headline">¶</a></h2>
<p>This recipe demonstrates manipulating color with the scikit image <a class="reference external" href="http://scikit-image.org/docs/stable/api/skimage.color.html">color module</a>.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">skimage.color</span> <span class="kn">import</span> <span class="n">rgb2lab</span><span class="p">,</span> <span class="n">lab2lch</span><span class="p">,</span> <span class="n">lch2lab</span><span class="p">,</span> <span class="n">lab2rgb</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;tests/data/RGB.byte.tif&quot;</span>
<span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;/tmp/saturation.tif&quot;</span>


<span class="k">def</span> <span class="nf">saturation</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">sat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Multiple saturation/chroma in LCH color space</span>
<span class="sd">    Input and output are 3-band RGB scaled 0 to 255</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># scale image 0 to 1</span>
    <span class="n">arr_norm</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="c1"># Convert colorspace</span>
    <span class="n">lch</span> <span class="o">=</span> <span class="n">rgb2lch</span><span class="p">(</span><span class="n">arr_norm</span><span class="p">)</span>
    <span class="c1"># Adjust chroma, band at index=1</span>
    <span class="n">lch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sat</span>
    <span class="c1"># Convert colorspace and rescale</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">lch2rgb</span><span class="p">(</span><span class="n">lch</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rgb2lch</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert RBG to LCH colorspace (via LAB)</span>
<span class="sd">    Input and output are in (bands, cols, rows) order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># reshape for skimage (bands, cols, rows) -&gt; (cols, rows, bands)</span>
    <span class="n">srgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># convert colorspace</span>
    <span class="n">lch</span> <span class="o">=</span> <span class="n">lab2lch</span><span class="p">(</span><span class="n">rgb2lab</span><span class="p">(</span><span class="n">srgb</span><span class="p">))</span>
    <span class="c1"># return in (bands, cols, rows) order</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">lch</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">lch2rgb</span><span class="p">(</span><span class="n">lch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert LCH to RGB colorspace (via LAB)</span>
<span class="sd">    Input and output are in (bands, cols, rows) order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># reshape for skimage (bands, cols, rows) -&gt; (cols, rows, bands)</span>
    <span class="n">slch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">lch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># convert colorspace</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">lab2rgb</span><span class="p">(</span><span class="n">lch2lab</span><span class="p">(</span><span class="n">slch</span><span class="p">))</span>
    <span class="c1"># return in (bands, cols, rows) order</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>

<span class="c1"># Increase color saturation by 60%</span>
<span class="n">array_sat</span> <span class="o">=</span> <span class="n">saturation</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">)</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">array_sat</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="code highlight-default"><div class="highlight"><pre><span></span>$ python docs/recipes/saturation.py
</pre></div>
</div>
<p>The original image</p>
<a class="reference internal image-reference" href="_images/RGB.byte.jpg"><img alt="_images/RGB.byte.jpg" src="_images/RGB.byte.jpg" style="width: 395.5px; height: 359.0px;" /></a>
<p>With increased saturation</p>
<a class="reference internal image-reference" href="_images/saturation.jpg"><img alt="_images/saturation.jpg" src="_images/saturation.jpg" style="width: 395.5px; height: 359.0px;" /></a>
</div>
<div class="section" id="generating-a-kmz-from-a-raster">
<h2>Generating a KMZ from a raster<a class="headerlink" href="#generating-a-kmz-from-a-raster" title="Permalink to this headline">¶</a></h2>
<p>A raster can be converted to a KMZ and opened in Google Earth using <code class="docutils literal"><span class="pre">rasterio</span></code> to access the raster metadata. Executing</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>$ python docs/recipes/raster_to_kmz.py
</pre></div>
</div>
<p>creates the file <code class="docutils literal"><span class="pre">green_box.tif</span></code>, which is a green image that extends from longitude -36 to -35 and latitude 74 to 75 in <code class="docutils literal"><span class="pre">EPSG:4326</span></code> projection, and then embeds this raster in a KMZ file <code class="docutils literal"><span class="pre">green_box.kmz</span></code>. In Google Earth, we can see the box inside Greenland (screenshot below).</p>
<a class="reference internal image-reference" href="_images/green_box_kmz.png"><img alt="_images/green_box_kmz.png" src="_images/green_box_kmz.png" style="width: 629.5px; height: 379.0px;" /></a>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="osgeo_gdal_migration.html" class="btn btn-neutral float-right" title="Migration Guide for osgeo.gdal users" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="developers.html" class="btn btn-neutral" title="Developers guide" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Mapbox.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.35.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>